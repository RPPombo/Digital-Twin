# ===== Identificação do device =====
SERIAL_DEVICE_ID=arduino-01

# ===== Filtro do SerialReader (média móvel por sensor) =====
FILTER_ENABLE=true
FILTER_WINDOW=500
# no topo do arquivo, junto com as outras ENV:
SERIAL_PRESS_MIN_KPA   = float(os.getenv("SERIAL_PRESS_MIN_KPA", "0"))
SERIAL_PRESS_MAX_KPA   = float(os.getenv("SERIAL_PRESS_MAX_KPA", "400"))
SERIAL_PRESS_MAX_STEP  = float(os.getenv("SERIAL_PRESS_MAX_STEP", "300"))  # kPa

SERIAL_HOLD_LAST_ON_NAN = os.getenv("SERIAL_HOLD_LAST_ON_NAN","true").lower() in ("1","true","yes","on")

# dentro da classe SerialReader.__init__:
self._last_vals = {"pressure": None, "distance": None, "temperature": None}

# ===== Replayer (para substituir o send_fake com dados mais suaves) =====
REPLAY_SPEED=1.0             # >1 acelera, <1 desacelera
REPLAY_LOOP=true
REPLAY_DEFAULT_DT_S=0.5      # período se não houver timestamp_ms
REPLAY_WARMUP_S=4.0          # ignora os primeiros X segundos (fase de calibração)
REPLAY_MAX_GAP_S=5.0         # limita "buracos" de tempo entre amostras

# Filtros do replayer (anti-calibração / anti-espirro)
REPLAY_HAMPEL_WIN=11
REPLAY_HAMPEL_K=3.0
REPLAY_AVG_WIN=25
REPLAY_USE_EMA=true
REPLAY_EMA_ALPHA=0.08

# Pós-filtro on-the-fly
REPLAY_DEADBAND=0.8          # não reage a ±X
REPLAY_SLEW_KPA_S=15.0       # kPa por segundo (pressão)
REPLAY_SLEW_MM_S=120.0       # mm por segundo (distância)

# Faixas de sanidade (descarta absurdos)
REPLAY_PRESS_MIN_KPA= 0 
REPLAY_PRESS_MAX_KPA=300
REPLAY_DIST_MIN_MM=0
REPLAY_DIST_MAX_MM=2000
REPLAY_TEMP_MIN_C=-50
REPLAY_TEMP_MAX_C=350

# Política de NaN no replay: keep (mantém) | drop (remove do payload)
REPLAY_NAN_POLICY=keep

# ===== Backend =====
APP_HOST=0.0.0.0
APP_PORT=8000
APP_RELOAD=true              # dev=true / prod=false

# ===== Caminho do arquivo para replay (ajuste para seu dataset real) =====
# Ex.: data/sim-arduino-01__pressure.csv  (ou .jsonl)
REPLAY_FILE=data/sim-arduino-01__pressure.csv
